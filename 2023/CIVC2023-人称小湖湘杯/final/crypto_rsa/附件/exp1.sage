from Crypto.Util.number import getPrime,GCD

from gmpy2 import *

n2 = 20369481027961668058257949652346266097405331865071244844827896944882851755421021125005038786750268341013032202394581223828526073179263634639721089663050687773353438686984875196973012077948955566738301337866191557952973517042420660699281973702694965572488938789954679350791243570953680441483360036599350550534192027759384675611155970913348616382186229565994100357427843446265863186624731991521034305958565644266001622849342042747046352413268149901263629515623929619659379883036239511300563910486156582808698915297257307692017642458823600500445082987244477251123335410633989767118317681371314078169733374888688620813839
leak1 = 110733171993470709195465104383246525062178362778220972191726705114514369848757940664883819735824778128179586221599072975207093223575285541338555960658178287486722693023393688158120847028382
n = n2
B = leak1<<400
# delta = ((B>>400)<<400)**2-4*n
delta = B**2-4*n
tmp = iroot(delta,2)
print(tmp)
tmp = iroot(delta,2)[0]
p1 = (B-tmp)//(2)
print(p1)



p_high = 134541671225018271403953787373408507465730892003631249716123043010464351342881237505189677861071006923092011330983761091184598196512437449946447759771425031294468141216072218813533336313657524467880090272881006395913313631318750309915844569487401367971190613041647395141514821670753155742964430170132258004003
# n = 
R.<x> = PolynomialRing(Zmod(n))
f = p_high + x
tmp = f.small_roots(2**454,0.4)
print(tmp)
x = tmp[0]
P = int(x+p_high)
print(n%P)
q = n//P
print("p2=",P)
print("q2=",q)
#p= 134541671225018271403953787373408507465730892003631249716123043010464351342881237505189677861071006923092011330983761091184598196512437449946447759771425031294468141216072218813533336313651823171925311705682558765317115569680736707328403560829555033008387085671352235353814183291570781754064065104600110875621
# q= 151399048655298148018688323609718705920605086712318698086250277971491481779504840614471253946764630599745412866850500656954922361816231030123945084396794404269982437117950486373905356265950808460057643971210951709676705550508291196476405125057071271317182732652055355984683359771176148502822187125614565868259