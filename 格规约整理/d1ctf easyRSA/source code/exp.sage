N = 24402191928494981635640497435944050736451453218629774561432653700273120014058697415669445779441226800209154604159648942665855233706977525093135734838825433023506185915211877990448599462290859092875150657461517275171867229282791419867655722945527203477335565212992510088077874648530075739380783193891617730212062455173395228143660241234491822044677453330325054451661281530021397747260054593565182679642519767415355255125571875708238139022404975788807868905750857687120708529622235978672838872361435045431974203089535736573597127746452000608771150171882058819685487644883286497700966396731658307013308396226751130001733
e1 = 4046316324291866910571514561657995962295158364702933460389468827072872865293920814266515228710438970257021065064390281148950759462687498079736672906875128944198140931482449741147988959788282715310307170986783402655196296704611285447752149956531303574680859541910243014672391229934386132475024308686852032924357952489090295552491467702140263159982675018932692576847952002081478475199969962357685826609238653859264698996411770860260854720047710943051229985596674736079206428312934943752164281391573970043088475625727793169708939179742630253381871307298938827042259481077482527690653141867639100647971209354276568204913
e2 = 1089598671818931285487024526159841107695197822929259299424340503971498264804485187657064861422396497630013501691517290648230470308986030853450089582165362228856724965735826515693970375662407779866271304787454416740708203748591727184057428330386039766700161610534430469912754092586892162446358263283169799095729696407424696871657157280716343681857661748656695962441400433284766608408307217925949587261052855826382885300521822004968209647136722394587701720895365101311180886403748262958990917684186947245463537312582719347101291391169800490817330947249069884756058179616748856032431769837992142653355261794817345492723
cipher = 5089249888618459947548074759524589606478578815336059949176718157024022678024841758856813241335191315643869492784030633661717346809979076682611760035885176766380484743187692409876479000444892361744552075578050587677106211969169204446554196613453202059517114911102484740265052582801216204900709316109336061861758409342194372241877343837978525533125320239702501424169171652846761028157198499078668564324989313965631396082388643288419557330802071756151476264735731881236024649655623821974147680672733406877428067299706347289297950375309050765330625591315867546015398294367460744885903257153104507066970239487158506328863

N = 22065331000829826394787485440936676686070161673993366441098154312337372345184116961378673017779809458451757088509268008267745885112876138512383375845598829961188572785830655529130629504204740813857985704440062545571531789587994712850560465951060668794702074583564914133269927295544837587352232044957352920267256686071411981347597647569611106603943392403581146833136988783765356359016111107848224798200682784236111254610873935241211538649215851994164276157655285758015519494435450060549614461729736479869912915801908324510198771101555933976578384314328753053570368838341774888418698456007474412212871151928483392122759
e1 = 3441186065468025251782297996593746115330442402779657998833255891033343614227561332216050240974586127562370540108601988877588662432447458116732843296850964903064710374039298546902712905701371544192167824359082775146893021378479740627848381861793074564623408244783773521104615841600336362932196974848328508533297745970760889182046386213064872300099329309610213587393401465685455093685702361984354438974021235782920840744414167573420811917366760357831066978697510556200959008948509447716434851125459073903124064210598093526241757603278369341282089689605261748868251195933127570306867866294388711878839642981062562487533
e2 = 10679777523116530434004877829367270579176865066137807349135074472834297073639269348738198103290865806298808608791544109481964553945511014411164282485800179266917164647022774813462578753425347674859425501601653173889144074297592490931005646524691475068655407112901468373979915110852255591542975591453026337359911413283170059853830249954067480625496916025411172958830189370392647803037916767966896966563089046388751196429957830454616534504048803294426544888317523425989639563255394807495045693901849251080286827571291667794821195356114036785251513575330674020017224354708675098098179597378288690203999392423638232341239
e3 = 2533704199121169582305890119054477533405155353604372307089821086500985853865023293107922478280193574642703598883741890503429018395973250170218968400290808221219061196903207786366066123760108819147012730697567501448114080697559554409225560865863893753203404802899594794417862740482612116448187437228394011752323208041370102289841866123077592619205806445109381248538959806372738973337433306093179968058554425786926096673943534152954483296439434085237899914101471418689016050020772496890794295942987846959240902243303427677069624894541182708980120518244195926101688522793590769335175112730234135407468842567381959442147
cipher = 14244793966911375715841183287254478287323430441866693253030556485820357117412958220619437267271684545270988974796236214513031715414613003668066960319717984883295263613233876633094555638583442227880149994350535073825143725526792079965493056588557338499740688957916024324281110628657518142460491670378196505985582390412127377607056438636843137353669714938041949980881246160196362205792982545772396857989047130419900726911387409311987679817513985434487343396419523582243752753394870117418042768627260932881075468435924442969350242121590680668855089829753847132637380452435510017011370859233003183187636320807373719900248

N = 25493045396236583465750001959704949909085856208207420051562587424179511009136203961912366100881738583207608281097664632943234856610361596307623670619892644462095971633201511807958235407682405048272988232499565194675809927128415649817416274358991996423498546394851306343877081660980412402119834478497730315129103134309461632920857133763077422290750847652854895603099173918609523171284238334339321054181907593041748039382771539305396983478518735165429754721492595487063057539050549339898841919986653202189029369259806037789851217711060624253431412102678124059299169171005334219719711440703135861982898869011194794433341
e1 = 386863360975331412732476869921099620338243336190491287818848897186996209336457605973897808161252141630654052481059964517542409273939336796532954961608051038460993873902830832401292829002772488663347171250667786604871234242087907199219413411385423442107688116038543817376640515238910770708066103622833528451068418823080409201557826452263781457028960723879494732917176208601722950011270694774089015776925947805114596258882101420139713794826885327302674657819631457721793863947172351260604945737868244674722562611727616859617712442246081725885225320972017790092521523737723230657785374458825648522738819912762155403769
e2 = 1778404752267496805661130259627101130794137096790399703901383649208046007949255455741907001189370854947772401970142026918948580862377587987332853762445704102522223432462402994008071762748958637951684335231935337008036286563497511723487556469919302846352721568202008103303739636210458423175195456397350545145719198292418237528148061852778897960651671434730841479050359153560507095170615997403679772986870613728225845723928931046416780420602994542072712099363335284195822066884805813328356754887611859768769106136862800269225400263046128714090343200945479557909693325971714653406852381913847199820974338682311404021071
e3 = 713912699659218835370796741504702502588635665835750305355407741013056737761860158741046538917824141734672068502810155491245824255557211964669731513692896372315042799950919456436622127186049787693007676425308485875428111177845136594746073345805648169492004512846748274514888790063982346502552585075433928018567078363297427914094295612013790352743921291847614251781544907442981537675509694275022505762230366317425428451572429782165398197071987687035730631926866065597231995353971681544630218764177339218921502365735228724878113973375875918094858304525376791870895562423061173530102953099480104997481524805927142762997
cipher = 2155768691217434435961714288212018108079935909385871377321641559764166795157794456942382940254503150775916771880323220663560915364512772159116321658045439736700831437311713562964840066919236573356894774290534949954681358028095558994685639314125444621556559270341178926725458949956699503627545481385506663912985981547553744631855736855995701518931756435911923685159616853610842226602298453413805246552509569053891005010180814317761880346977533769000480956048028714807506905945939298488945453857234873676025860919078764368819920487107719415979650051930394229975135699235895876260555526086342716089682859134453521761136

B = Matrix([
    [1, -N,   0,   N ^ 2],
    [0, e1, -e1, -e1*N],
    [0,  0,  e2, -e2*N],
    [0,  0,   0, e1*e2]
])

x = 0.355

D = Matrix([
    [N,            0,            0,  0],
    [0, int(N^(1/2)),            0,  0],
    [0,            0, int(N^(1+x)),  0],
    [0,            0,            0,  1]

])

res = B*D
print(type(res))
lll = res.LLL() # v2
y =  lll[0]
inv = res.inverse()
x = y*inv

# ---------------------------------------
phi = int(e1*int(x[1]))//int(x[0])
print('phi',phi)
print('-----------------------')

bezout = xgcd(e1, phi)
d1 = Integer(mod(bezout[1], phi))
print('d:',d1)
plain1 = pow(cipher,d1,N)
# -------------------------------------
flag = (int(plain1))
print("int ",flag)
print(bytes.fromhex(hex(flag)[2:]))
print('---------------------------------')
# ----------------------------------------------

d = inverse_mod(e2,phi)
flag = pow(cipher,d,N)
print(flag)
print(hex(flag))
print(bytes.fromhex(hex(flag)[2:]))

'''
bezout = xgcd(e2, phi)
d2 = Integer(mod(bezout[1], phi))
plain2 = pow(cipher,d2,N)
flag = hex(int(plain2))[2:-1].decode('hex')
print flag
'''
