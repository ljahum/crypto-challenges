---
title: "Writeup for crypto in RCTF 2021"
subtitle: 
date: 2021-09-14 00:07:00+08:00
# weight: 1000
draft: true
author: "ljahum"
description: "learnt many"
tags: 
- math
- crypto
# crypto 25math 6codes 5bin 4Nuil 
categories: 
- CTF
# - CTF posts notes å…¶ä»–

# å†…æ³¢æ ‡é¢˜å›¾ç‰‡

hiddenFromHomePage: false

math:
  enable: true
---
<!--more-->





> ðŸ‘´ç¬¬äºŒæ¬¡æ‰“RCTFï¼Œå‘¨æœ«åˆæ¥è‹Ÿäº†ä¸ªæ°´é¢˜ï¼ŒðŸ‘´å¤ªæžå§èœäº†ï¼Œå…¨é é˜Ÿå‹å¸¦

![](https://gitee.com/ljahum/images/raw/master/img/20210913104029.png)



## uncommon1

> æ°”æ­»äº†æ°”æ­»äº†ï¼Œæ˜Žæ˜Žéƒ½å·²ç»æŠŠfastgcdä¿®å¥½äº†
>
> æ‹¿ç€fastgcdæ—¥äº†åŠå¤©uncommon2ï¼Œä»¥ä¸ºæ²¡ç”¨ï¼Œç›´æŽ¥æ‰”æŽ‰äº†
>
> æ·¦ï¼Œæ ¹æœ¬æ²¡è€ƒè™‘è¿‡ä¼šå‡ºçŽ°åŒæ ·çš„ç´ æ•°ï¼Œå¤ªèœäº†ï¼Œæ˜Žæ˜Žä¸Šè¯¾å­¦è¿‡çš„ðŸ˜€ðŸ˜€ðŸ˜€

### Fastgcd

è¿™æ˜¯ä¸ªä»€ä¹ˆçŽ©æ„å‘¢ï¼Ÿ

ä¼—æ‰€å‘¨çŸ¥GCDå¯ä»¥å¿«é€Ÿçš„ç®—å‡ºä¸¤ä¸ªæ•°æœ€å¤§å…¬çº¦æ•°ï¼Œä½†å¦‚æžœæœ‰$N$ä¸ªæ•°æˆ‘å¯èƒ½è¦ç®—å¤§æ¦‚$N^2$æ¬¡

äºŽæ˜¯ä¸€ç¾¤æ•°å­¦å®¶æƒ³ï¼šèƒ½ä¸èƒ½æ¦‚ä¸€ä¸ªç®—æ³•å§å®ƒçš„å¤æ‚åº¦é™ä½Žä¸€ç‚¹ï¼Ÿ

![](https://gitee.com/ljahum/images/raw/master/img/20210914230602.png)

å¤§æ¦‚æµç¨‹å¦‚ä¸‹

~~ç”Ÿæˆæ ‘è¿™ç§æ¦‚å¿µå·²ç»å¤ªä¹…è¿œäº†ï¼ŒðŸ‘´è®°ä¸æ¸…äº†~~

![](https://gitee.com/ljahum/images/raw/master/img/20210914230805.png)

æˆ–è€…é•¿è¿™æ ·ï¼š

![](https://gitee.com/ljahum/images/raw/master/img/image-20210914232240947.png)

uç¥žä¸çŸ¥åœ¨é‚£ç¯‡æ–‡ç« æ‰¾åˆ°çš„å®žçŽ°æµç¨‹ï¼š

![](https://gitee.com/leonsec/images/raw/master/upload_26fe1784ad7c7f16345c3deb248fa320.png)

æ–‡ç« è¯´å¤æ‚åº¦ä¸º$O(N(lgN)^2lg(lgN))$

å’Œ$N^2$ç›¸æ¯”å°±å¾ˆèˆ’æœäº†



### implement

uç¥žçš„è¯æ˜Žï¼š

![](https://gitee.com/ljahum/images/raw/master/img/20210914234126.png)

å®Œå…¨æ²¡æƒ³åˆ°è¿™ä¸€å±‚ï¼Œä¸Šå­¦æœŸè¿˜å­¦è¿‡ï¼Œå¤ªæ‘†äº†

---

fastgcdå®žçŽ°ï¼š

ä½ è®©ðŸ‘´å®žçŽ°è¿™çŽ©æ„ðŸ‘´è‚¯å®šæ˜¯ä¼šå½“åœºæ‘†çƒ‚çš„ï¼Œæ‰€ä»¥ðŸ‘´æ‰¾åˆ°äº†çŽ°æˆçš„ä»“åº“

https://github.com/sagi/fastgcd

æ‹–ä¸‹æ¥å‘çŽ°ä¸èƒ½ç«‹é©¬intsallï¼ŒäºŽæ˜¯æˆ‘ä»¬æ¥ç€æ‰‹ä¿®install

```shell
#!/bin/bash

__exists() {
    which $1 1>/dev/null 2>&1
}

get="fetch";
! __exists fetch && get="curl -OL";

if [ ! -d gmp-5.0.5 ];
then

    if [ ! -f gmp-5.0.5.tar.bz2 ];
    then
        $get ftp://ftp.gmplib.org/pub/gmp-5.0.5/gmp-5.0.5.tar.bz2
    fi

    sum=`openssl sha1 gmp-5.0.5.tar.bz2 | awk -F' ' '{print $2}'`

    if [[ $sum != "12a662456033e21aed3e318aef4177f4000afe3b" ]];
    then
        echo ''
        echo '=========================================='
        echo 'ERROR: could not verify gmp-5.0.5.tar.bz2;'
        echo 'Downloaded over untrusted channel (non-https)'
        echo '=========================================='
        exit;
    fi

    tar xf gmp-5.0.5.tar.bz2
fi

cd gmp-5.0.5
patch -p 1 < ../gmp-5.0.5.patch
mkdir ../gmp-patched
./configure --prefix=$PWD/../gmp-patched/
make
make install
cd ..
make
```

æ˜¾ç„¶æ˜¯`$get ftp://ftp.gmplib.org/pub/gmp-5.0.5/gmp-5.0.5.tar.bz2`å‡ºäº†é—®é¢˜ï¼ˆåæ­£æˆ‘ä¸‹è½½ä¸ä¸‹æ¥ï¼‰

äºŽæ˜¯ä¸Šgmpå®˜ç½‘æ‰‹åŠ¨ä¸‹ä¸€ä¸ª

![](https://gitee.com/ljahum/images/raw/master/img/20210914233123.png)

ä¿®æ”¹install.shï¼Œä¿®æ”¹æºç æŠ¥é”™çš„é¢„ç¼–è¯‘ä»£ç 

fastgcd.c

```c
#define NTHREADS 4 // Get from compile-time argument?

// #ifdef mpz_raw_64 // if patched gmp, use large format int i/o
// #define __mpz_inp_raw mpz_inp_raw_64
// #define __mpz_out_raw mpz_out_raw_64
// #else // otherwise use normal i/o...beware 2^31 byte size limit
#define __mpz_inp_raw mpz_inp_raw
#define __mpz_out_raw mpz_out_raw
// #endif
```

install.sh

```shell
tar xf gmp-5.0.5.tar.bz2
cd gmp-5.0.5
patch -p 1 < ../gmp-5.0.5.patch
mkdir ../gmp-patched
./configure --prefix=$PWD/../gmp-patched/
make
make install
cd ..
make
```

ç›´æŽ¥installç¼–è¯‘



æå–æ•°æ®ä¸ºinput.modleçš„æ ¼å¼

```python
from Crypto.Util.number import *
from tqdm import 
size = 2**22
with open("lN.bin","rb") as f:
    data = f.read()

f1 = open("data","w+")
for i in tqdm(range(size)):
    tmp = hex(bytes_to_long(data[i*64:(i+1)*64]))[2:]
    f1.write(tmp+'\n')

```
å¼€è·‘~~

![](https://gitee.com/ljahum/images/raw/master/img/X9%605(RM~)CL34X%60SG52U$D5.jpg)

ç»“æžœï¼š

æ¯”uç¥žå¤šèŠ±äº†5åˆ†é’Ÿï¼Œè¿˜æ˜¯æœºå­ä¸å¤ªè¡ŒðŸ¨ðŸ¨ðŸ¨

![](https://gitee.com/ljahum/images/raw/master/img/20210914233648.png)

### solve

```python
In [2]: s=0x7f2ec3455a5f6763645f5472333333333333338a2068398023
   ...:

In [3]: from Crypto.Util.number import *

In [4]: long_to_bytes(s)
Out[4]: b'\x7f.\xc3EZ_gcd_Tr3333333\x8a h9\x80#'

In [5]:
```





## uncommon2

A AGCD problemï¼Œusing lattice reduce is simple to solve it

### AGCD

$n_i=p*q_i+r_i$å½¢å¼çš„AGCDé—®é¢˜ï¼Œåˆ©ç”¨æ ¼è§„çº¦æ˜¯å¯è§£çš„

ðŸ‘´çœ‹åˆ°å¾ˆå¤šæ–‡ç« éƒ½æœ‰æ‰“æ³•ä»‹ç»ï¼Œä½†æ˜¯åªæœ‰è¿™ç¯‡ä»‹ç»äº†æ ¼å­çš„ç»“æž„ï¼ˆ



https://martinralbrecht.wordpress.com/2020/03/21/the-approximate-gcd-problem/



![](https://gitee.com/ljahum/images/raw/master/img/20210913000636.png)

ä¸€æŠŠæ¢­å“ˆå°±èƒ½è§£uncommon2

### solve

```python
#! /usr/bin/sage
from sage.all import *
from sage.groups.generic import bsgs
from Crypto.Util.number import *
from Crypto.Util.number import *
with open("lN.bin","rb") as f:
    data = f.read()

f1 = open("./data","wb")
size = 128
print('size',size)
nn=[]  
for i in range(size):
    nn.append((bytes_to_long(data[i*64:(i+1)*64])))
B = [[0 for i in range(size)] for _ in range(size)]
x0 = nn[0]
B[0][0]=2^305
for i in range(1,size):
    B[0][i]=nn[i]
    # B[0][i]=i
# print(B)
# print(x0)
print('start LLL....')
for i in range(1,size):
    B[i][i]=-x0
B = Matrix(B)
V = B.LLL()
q = abs(V[0][0])

q = q>>305
print(x0-q)
p = x0//q
print(long_to_bytes(p))


# flag{Simpl3_LLL_TrIck}
```

## attachment



## refer

https://www.usenix.org/system/files/conference/usenixsecurity12/sec12-final228.pdf

https://cr.yp.to/lineartime/multapps-20080503.pdf

https://github.com/sagi/fastgcd